# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–î–∞—Ç–∞:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

---

## 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1.1 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Frontend:**
- Next.js 14.2.33 (App Router)
- React 18.3.1
- TypeScript 5.7.2
- Tailwind CSS 3.4.18
- TanStack React Query 5.90.10
- Zod 3.25.76

**Backend:**
- Node.js + Express
- TypeScript
- Clean Architecture (Domain, Application, Infrastructure, Presentation)
- PostgreSQL (stops, routes, flights)
- Redis (graph cache)

### 1.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

**Backend API Response (`/api/v1/routes/search`):**
```typescript
{
  success: true,
  routes: IBuiltRoute[],
  alternatives?: IBuiltRoute[],
  riskAssessment?: IRiskAssessment
}

interface IBuiltRoute {
  routeId: string;
  fromCity: string;
  toCity: string;
  date: string;
  passengers: number;
  segments: IRouteSegmentDetails[];
  totalDuration: number;
  totalPrice: number;
  transferCount: number;
  transportTypes: TransportType[];
  departureTime: string;
  arrivalTime: string;
}

interface IRouteSegmentDetails {
  segment: {
    segmentId: string;
    fromStopId: string;
    toStopId: string;
    routeId: string;
    transportType: TransportType; // 'BUS' | 'TRAIN' | 'PLANE' | 'WATER' | 'FERRY'
    distance?: number;
    estimatedDuration?: number;
    basePrice?: number;
  };
  selectedFlight?: IAvailableFlight;
  departureTime: string;
  arrivalTime: string;
  duration: number;
  price: number;
  transferTime?: number;
}
```

**Stops –∏–º–µ—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:**
```typescript
interface RealStop {
  id: string;
  name: string;
  latitude: number;
  longitude: number;
  cityId?: string;
  isAirport: boolean;
  isRailwayStation: boolean;
}
```

### 1.3 –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```
frontend/src/
‚îú‚îÄ‚îÄ modules/routes/
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts (IBuiltRoute, IRouteSegmentDetails)
‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route-search/ (—Ñ–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route-list/ (—Å–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route-details/ (–¥–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞)
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îî‚îÄ‚îÄ route-adapter.ts (–∞–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö)
‚îî‚îÄ‚îÄ shared/
    ‚îî‚îÄ‚îÄ ui/ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
```

---

## 2. –í—ã–±–æ—Ä –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### 2.1 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –°–µ—Ä–≤–∏—Å | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã | –ü–æ–¥—Ö–æ–¥–∏—Ç? |
|--------|-------|--------|-----------|
| **Yandex Maps** | ‚Ä¢ –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –†–æ—Å—Å–∏–∏<br>‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤<br>‚Ä¢ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º<br>‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ | ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç API –∫–ª—é—á<br>‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ | ‚úÖ **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** |
| **Google Maps** | ‚Ä¢ –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ<br>‚Ä¢ –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å<br>‚Ä¢ –ú–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π | ‚Ä¢ –î–æ—Ä–æ–≥–æ–π –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è<br>‚Ä¢ –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –†–§ | ‚ö†Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
| **2–ì–ò–° Maps** | ‚Ä¢ –û—Ç–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –†–æ—Å—Å–∏–∏<br>‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ | ‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å<br>‚Ä¢ –ú–µ–Ω—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ |
| **Leaflet + OpenStreetMap** | ‚Ä¢ –ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π<br>‚Ä¢ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å<br>‚Ä¢ –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π<br>‚Ä¢ –ù–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á–∞ | ‚Ä¢ –ù—É–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ<br>‚Ä¢ –ú–µ–Ω—å—à–µ –≥–æ—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π | ‚úÖ **–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê** |
| **MapLibre GL JS** | ‚Ä¢ Open Source<br>‚Ä¢ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å<br>‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ | ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏<br>‚Ä¢ –ú–µ–Ω—å—à–µ –≥–æ—Ç–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | ‚ö†Ô∏è –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö |

### 2.2 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **Yandex Maps API**

**–ü–æ—á–µ–º—É:**
1. **–õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –†–æ—Å—Å–∏–∏** ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã, –¥–æ—Ä–æ–≥–∏, –Ω–∞—Å–µ–ª—ë–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã
2. **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ** ‚Äî –¥–æ 25,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP)
3. **–ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** ‚Äî `@pbe/react-yandex-maps` –¥–ª—è React
4. **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º** ‚Äî –ø—Ä–æ—â–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** Leaflet + OpenStreetMap (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

---

## 3. –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è –∫–∞—Ä—Ç—ã

```typescript
interface RouteMapData {
  routeId: string;
  fromCity: string;
  toCity: string;
  segments: RouteSegmentMapData[];
  bounds: {
    north: number;
    south: number;
    east: number;
    west: number;
  };
  totalDistance: number;
  totalDuration: number;
}

interface RouteSegmentMapData {
  segmentId: string;
  transportType: TransportType;
  fromStop: {
    id: string;
    name: string;
    latitude: number;
    longitude: number;
    cityName: string;
    isTransfer: boolean; // true –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
  };
  toStop: {
    id: string;
    name: string;
    latitude: number;
    longitude: number;
    cityName: string;
    isTransfer: boolean;
  };
  // –ü–æ–ª–∏–ª–∏–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–∏–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞
  polyline: {
    // Encoded polyline (Google/Yandex —Ñ–æ—Ä–º–∞—Ç)
    encoded: string;
    // –ò–ª–∏ –º–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç [lat, lng][]
    coordinates: [number, number][];
  };
  // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞
  style: {
    color: string; // –¶–≤–µ—Ç –ª–∏–Ω–∏–∏
    weight: number; // –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏
    opacity: number; // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
    dashArray?: string; // –î–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
  };
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  distance: number; // –∫–º
  duration: number; // –º–∏–Ω—É—Ç—ã
  price: number;
  departureTime: string;
  arrivalTime: string;
}
```

### 3.2 –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

```typescript
const TRANSPORT_COLORS: Record<TransportType, string> = {
  PLANE: '#0066CC',    // –°–∏–Ω–∏–π ‚Äî —Å–∞–º–æ–ª—ë—Ç
  TRAIN: '#00CC66',    // –ó–µ–ª—ë–Ω—ã–π ‚Äî –ø–æ–µ–∑–¥
  BUS: '#FF9900',      // –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äî –∞–≤—Ç–æ–±—É—Å
  FERRY: '#00CCFF',    // –ì–æ–ª—É–±–æ–π ‚Äî –ø–∞—Ä–æ–º
  WATER: '#0066FF',    // –°–∏–Ω–∏–π ‚Äî –≤–æ–¥–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
  TAXI: '#FF6600',     // –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äî —Ç–∞–∫—Å–∏
  UNKNOWN: '#999999',  // –°–µ—Ä—ã–π ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π
};

const TRANSPORT_ICONS: Record<TransportType, string> = {
  PLANE: '‚úàÔ∏è',
  TRAIN: 'üöÇ',
  BUS: 'üöå',
  FERRY: '‚õ¥Ô∏è',
  WATER: 'üö¢',
  TAXI: 'üöï',
  UNKNOWN: 'üìç',
};
```

### 3.3 –¢–∏–ø—ã –º–∞—Ä–∫–µ—Ä–æ–≤

```typescript
interface MapMarker {
  id: string;
  type: 'start' | 'end' | 'transfer' | 'segment-start' | 'segment-end';
  position: [number, number]; // [latitude, longitude]
  title: string;
  description?: string;
  icon?: string; // URL –∏–ª–∏ emoji
  color?: string;
  zIndex?: number;
}
```

---

## 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API

### 4.1 –ù–æ–≤—ã–π endpoint –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã

**GET `/api/v1/routes/:routeId/map`**

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–∞, –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ.

**Request:**
```
GET /api/v1/routes/route-123/map
```

**Response:**
```typescript
{
  success: true,
  routeId: string;
  fromCity: string;
  toCity: string;
  segments: Array<{
    segmentId: string;
    transportType: TransportType;
    fromStop: {
      id: string;
      name: string;
      latitude: number;
      longitude: number;
      cityName: string;
    };
    toStop: {
      id: string;
      name: string;
      latitude: number;
      longitude: number;
      cityName: string;
    };
    // –ü–æ–ª–∏–ª–∏–Ω–∏—è –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ (Great Circle –¥–ª—è —Å–∞–º–æ–ª—ë—Ç–∞, –ø—Ä—è–º–∞—è –¥–ª—è –¥—Ä—É–≥–∏—Ö)
    polyline: {
      coordinates: [number, number][]; // [[lat, lng], ...]
    };
    distance: number;
    duration: number;
    price: number;
    departureTime: string;
    arrivalTime: string;
  }>;
  bounds: {
    north: number;
    south: number;
    east: number;
    west: number;
  };
}
```

### 4.2 –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ endpoint

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `/api/v1/routes/search` –¥–æ–±–∞–≤–∏–≤ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `includeMapData=true`.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- –ú–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–µ–∫
- –ü—Ä–æ—â–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
- –ù–µ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint `/api/v1/routes/:routeId/map` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏.

---

## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### 5.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è –∫–∞—Ä—Ç—ã

```
frontend/src/modules/routes/
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îî‚îÄ‚îÄ route-map/              # –ù–æ–≤—ã–π –º–æ–¥—É–ª—å
‚îÇ       ‚îú‚îÄ‚îÄ ui/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map.tsx           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-segment.tsx   # –°–µ–≥–º–µ–Ω—Ç –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-marker.tsx    # –ú–∞—Ä–∫–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-popup.tsx     # Popup —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-controls.tsx  # –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route-map-legend.tsx     # –õ–µ–≥–µ–Ω–¥–∞ —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ use-route-map-data.ts    # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ use-route-map-bounds.ts  # –†–∞—Å—á—ë—Ç –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ use-route-map-segments.ts # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ lib/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ map-data-adapter.ts      # –ê–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—Ä—Ç—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ polyline-builder.ts      # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–∏–ª–∏–Ω–∏–π
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ map-styles.ts            # –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ types.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
```

### 5.2 SOLID-–ø—Ä–∏–Ω—Ü–∏–ø—ã

**Single Responsibility:**
- `RouteMap` ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
- `RouteMapSegment` ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç
- `RouteMapMarker` ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–∞—Ä–∫–µ—Ä
- `useRouteMapData` ‚Äî —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**Open/Closed:**
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è `IMapProvider` –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –õ–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å Yandex Maps –Ω–∞ Leaflet –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**Liskov Substitution:**
- –í—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `IMapProvider` –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã

**Interface Segregation:**
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∫–∞—Ä—Ç—ã

**Dependency Inversion:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (`IMapProvider`), –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

---

## 6. –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 —á–∞—Å–∞)

#### 1.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Frontend:**
```bash
cd frontend
npm install @pbe/react-yandex-maps yandex-maps
# –∏–ª–∏ –¥–ª—è Leaflet:
npm install leaflet react-leaflet @types/leaflet
```

#### 1.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞ (–¥–ª—è Yandex Maps)

**`.env.local`:**
```env
NEXT_PUBLIC_YANDEX_MAPS_API_KEY=your_api_key_here
```

**`next.config.js`:**
```javascript
env: {
  NEXT_PUBLIC_YANDEX_MAPS_API_KEY: process.env.NEXT_PUBLIC_YANDEX_MAPS_API_KEY,
}
```

#### 1.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/types.ts`

---

### –≠—Ç–∞–ø 2: Backend ‚Äî Endpoint –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã (2-3 —á–∞—Å–∞)

#### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

**–§–∞–π–ª:** `backend/src/presentation/controllers/RouteMapController.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ `routeId`
- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –∏–∑ –ë–î
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–∏–ª–∏–Ω–∏–π –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏
- –†–∞—Å—á—ë—Ç –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã (bounds)
- –í–æ–∑–≤—Ä–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—Ä—Ç—ã

#### 2.2 Use Case –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `backend/src/application/route-builder/use-cases/BuildRouteMapDataUseCase.ts`

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `IBuiltRoute` –∏ `IStopRepository`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞:
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã `fromStop` –∏ `toStop`
  - –°—Ç—Ä–æ–∏—Ç –ø–æ–ª–∏–ª–∏–Ω–∏—é (Great Circle –¥–ª—è —Å–∞–º–æ–ª—ë—Ç–∞, –ø—Ä—è–º–∞—è –¥–ª—è –¥—Ä—É–≥–∏—Ö)
  - –î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ü–≤–µ—Ç, –∏–∫–æ–Ω–∫–∞)
- –í—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã

#### 2.3 –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª–∏–ª–∏–Ω–∏–π

**–§–∞–π–ª:** `backend/src/shared/utils/polyline-builder.ts`

**–§—É–Ω–∫—Ü–∏–∏:**
- `buildGreatCirclePolyline(from, to, steps)` ‚Äî –¥–ª—è —Å–∞–º–æ–ª—ë—Ç–∞
- `buildStraightPolyline(from, to)` ‚Äî –¥–ª—è –Ω–∞–∑–µ–º–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- `encodePolyline(coordinates)` ‚Äî –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç Google/Yandex

#### 2.4 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–∞

**–§–∞–π–ª:** `backend/src/presentation/routes/index.ts`

–î–æ–±–∞–≤–∏—Ç—å:
```typescript
router.get('/routes/:routeId/map', RouteMapController.getRouteMap);
```

---

### –≠—Ç–∞–ø 3: Frontend ‚Äî –ê–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö (1 —á–∞—Å)

#### 3.1 –ê–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/lib/map-data-adapter.ts`

**–§—É–Ω–∫—Ü–∏—è:**
```typescript
export function adaptRouteToMapData(
  route: IBuiltRoute,
  mapData: RouteMapDataResponse
): RouteMapData
```

**–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç:**
- `IBuiltRoute` + –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã ‚Üí `RouteMapData`
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –º–∞—Ä—à—Ä—É—Ç–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
- –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞

---

### –≠—Ç–∞–ø 4: Frontend ‚Äî –•—É–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–π (2 —á–∞—Å–∞)

#### 4.1 –•—É–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/hooks/use-route-map-data.ts`

```typescript
export function useRouteMapData(routeId: string) {
  return useQuery({
    queryKey: ['route-map', routeId],
    queryFn: () => fetchRouteMapData(routeId),
    enabled: !!routeId,
  });
}
```

#### 4.2 –•—É–∫ —Ä–∞—Å—á—ë—Ç–∞ –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/hooks/use-route-map-bounds.ts`

**–§—É–Ω–∫—Ü–∏—è:** –í—ã—á–∏—Å–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞.

---

### –≠—Ç–∞–ø 5: Frontend ‚Äî –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã (4-6 —á–∞—Å–æ–≤)

#### 5.1 –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã (Yandex Maps –∏–ª–∏ Leaflet)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ zoom –∏ bounds
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã

#### 5.2 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ–≥–º–µ–Ω—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-segment.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–∏–ª–∏–Ω–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞
- –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –ò–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–∞ –ª–∏–Ω–∏–∏
- Popup –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç

#### 5.3 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–∞—Ä–∫–µ—Ä–∞

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-marker.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- –†–∞–∑–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è start/end/transfer
- Popup —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

#### 5.4 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–µ–≥–µ–Ω–¥—ã

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-legend.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ —Å —Ü–≤–µ—Ç–∞–º–∏
- –ò–∫–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

---

### –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π –º–∞—Ä—à—Ä—É—Ç–∞ (1-2 —á–∞—Å–∞)

#### 6.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-details/ui/route-details-view.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é —Å –∫–∞—Ä—Ç–æ–π
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–ø–∏—Å–∫–æ–º —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ –∫–∞—Ä—Ç–æ–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –∫–ª–∏–∫ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç ‚Üí –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ

---

### –≠—Ç–∞–ø 7: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ (2 —á–∞—Å–∞)

#### 7.1 –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö–Ω–æ–ø–∫–∏ "–ü—Ä–µ–¥—ã–¥—É—â–∏–π"/"–°–ª–µ–¥—É—é—â–∏–π" –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

#### 7.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

## 7. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### 7.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã Backend

```
backend/src/
‚îú‚îÄ‚îÄ presentation/
‚îÇ   ‚îî‚îÄ‚îÄ controllers/
‚îÇ       ‚îî‚îÄ‚îÄ RouteMapController.ts          # –ù–æ–≤—ã–π
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ route-builder/
‚îÇ       ‚îî‚îÄ‚îÄ use-cases/
‚îÇ           ‚îî‚îÄ‚îÄ BuildRouteMapDataUseCase.ts  # –ù–æ–≤—ã–π
‚îî‚îÄ‚îÄ shared/
    ‚îî‚îÄ‚îÄ utils/
        ‚îî‚îÄ‚îÄ polyline-builder.ts            # –ù–æ–≤—ã–π
```

### 7.2 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã Frontend

```
frontend/src/modules/routes/
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îî‚îÄ‚îÄ route-map/                         # –ù–æ–≤—ã–π –º–æ–¥—É–ª—å
‚îÇ       ‚îú‚îÄ‚îÄ ui/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-segment.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-marker.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-popup.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route-map-controls.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route-map-legend.tsx
‚îÇ       ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ use-route-map-data.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ use-route-map-bounds.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ use-route-map-segments.ts
‚îÇ       ‚îú‚îÄ‚îÄ lib/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ map-data-adapter.ts
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ polyline-builder.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ map-styles.ts
‚îÇ       ‚îú‚îÄ‚îÄ types.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ route-map-api.ts                    # –ù–æ–≤—ã–π (API –∫–ª–∏–µ–Ω—Ç)
```

---

## 8. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

### 8.1 –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–¶–≤–µ—Ç –ª–∏–Ω–∏–∏** ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
2. **–¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏** ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (–¥–ª–∏–Ω–Ω–µ–µ = —Ç–æ–ª—â–µ)
3. **–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è** ‚Äî –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
4. **–ò–∫–æ–Ω–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** ‚Äî –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
5. **–ú–∞—Ä–∫–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–æ–∫** ‚Äî —Ä–∞–∑–Ω—ã–µ –¥–ª—è start/end/transfer

### 8.2 –ê–Ω–∏–º–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ bounds

### 8.3 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –≤ React Query
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
- Debounce –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–∞—Ä—Ç—ã

---

## 9. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 9.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π –º–∞—Ä—à—Ä—É—Ç–∞

```tsx
import { RouteMap } from '@/modules/routes/features/route-map';

export function RouteDetailsView({ routeId }: { routeId: string }) {
  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
      {/* –°–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ */}
      <RouteSegments routeId={routeId} />
      
      {/* –ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞ */}
      <RouteMap routeId={routeId} />
    </div>
  );
}
```

### 9.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤

```tsx
import { RouteMap } from '@/modules/routes/features/route-map';

export function RouteListItem({ route }: { route: IBuiltRoute }) {
  const [showMap, setShowMap] = useState(false);
  
  return (
    <div>
      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ */}
      <RouteInfo route={route} />
      
      {/* –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞ –∫–∞—Ä—Ç—ã */}
      <button onClick={() => setShowMap(!showMap)}>
        {showMap ? '–°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É' : '–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ'}
      </button>
      
      {/* –ö–∞—Ä—Ç–∞ (—É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥) */}
      {showMap && <RouteMap routeId={route.routeId} />}
    </div>
  );
}
```

---

## 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 10.1 Unit —Ç–µ—Å—Ç—ã

- –ê–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–∏–ª–∏–Ω–∏–π
- –†–∞—Å—á—ë—Ç –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã
- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤

### 10.2 Integration —Ç–µ—Å—Ç—ã

- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã —á–µ—Ä–µ–∑ API
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

### 10.3 E2E —Ç–µ—Å—Ç—ã

- –ü–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–∞ ‚Üí –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç—ã
- –ö–ª–∏–∫ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç ‚Üí –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

## 11. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 11.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- JSDoc –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–ø—Å–æ–≤

### 11.2 API

- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ endpoint
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## 12. –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

### Backend
- [ ] –°–æ–∑–¥–∞—Ç—å `RouteMapController.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `BuildRouteMapDataUseCase.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `polyline-builder.ts`
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç `/api/v1/routes/:routeId/map`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è use case
- [ ] –î–æ–±–∞–≤–∏—Ç—å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### Frontend
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `route-map`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `RouteMap`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `RouteMapSegment`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `RouteMapMarker`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ `useRouteMapData`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `RouteDetailsView`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–µ–≥–µ–Ω–¥—É —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API –∫–ª—é—á Yandex Maps
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## 13. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

- **–≠—Ç–∞–ø 1 (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞):** 1-2 —á–∞—Å–∞
- **–≠—Ç–∞–ø 2 (Backend):** 2-3 —á–∞—Å–∞
- **–≠—Ç–∞–ø 3 (–ê–¥–∞–ø—Ç–µ—Ä):** 1 —á–∞—Å
- **–≠—Ç–∞–ø 4 (–•—É–∫–∏):** 2 —á–∞—Å–∞
- **–≠—Ç–∞–ø 5 (–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã):** 4-6 —á–∞—Å–æ–≤
- **–≠—Ç–∞–ø 6 (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è):** 1-2 —á–∞—Å–∞
- **–≠—Ç–∞–ø 7 (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã):** 2 —á–∞—Å–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 2-3 —á–∞—Å–∞
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 1-2 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ:** 16-23 —á–∞—Å–∞ (2-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)

---

## 14. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ Yandex Maps
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Leaflet + OpenStreetMap –∫–∞–∫ fallback

### –†–∏—Å–∫ 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

### –†–∏—Å–∫ 3: –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª–∏–ª–∏–Ω–∏–π –¥–ª—è –Ω–∞–∑–µ–º–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è MVP, –≤ –±—É–¥—É—â–µ–º ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π

---

**–ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ù–∞—á–∏–Ω–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1?**

