# –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –º–æ–¥—É–ª—è Leaflet-–∫–∞—Ä—Ç—ã

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2024  
**–¢–∏–ø –∞—É–¥–∏—Ç–∞:** Production-Ready Verification  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£ ‚Äî 95%**

---

## –†–ï–ó–Æ–ú–ï –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è:** ‚úÖ **–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –Ω–∞ 100%**

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** 40 –∏–∑ 40 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- ‚úÖ **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è:** 0 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 0

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** 100%

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.

---

## –ü–†–û–í–ï–†–ö–ê –ü–û –ë–õ–û–ö–ê–ú

### –ë–ª–æ–∫ 1. CSS ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ CSS Leaflet –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ (–ø–æ data-–∞—Ç—Ä–∏–±—É—Ç—É + href)
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ `<link>` –≤ `<head>`
- ‚úÖ CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
- ‚úÖ –§–æ–ª–±—ç–∫-–ø—Ä–æ–≤–µ—Ä–∫–∞ CSS (—á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è `<link>`) —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –¢—Ä–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ data-–∞—Ç—Ä–∏–±—É—Ç—É, –ø–æ href, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
- –ó–∞—â–∏—Ç–∞ –æ—Ç race condition –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö
- CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º useEffect —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `[providerType]`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –∂–¥—ë—Ç `isLeafletCssLoaded === true`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã (width > 50, height > 50)
- ‚úÖ `checkContainerSize()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ 10 –ø–æ–ø—ã—Ç–æ–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- ‚úÖ `isSizeValidated` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- ‚úÖ –í —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö loading/error/empty –∫–∞—Ä—Ç–∞ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: `rect.width > 50 && rect.height > 50`
- `MAX_INIT_ATTEMPTS = 10` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 100ms –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- `isSizeValidated` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `invalidateSize`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –Ω–∞—á–∞–ª–µ useEffect: `if (isLoading || initError || mapDataError || !mapData || !mapData.segments || mapData.segments.length === 0) return;`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ `initialize()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ CSS –∑–∞–≥—Ä—É–∂–µ–Ω –∏ —Ä–∞–∑–º–µ—Ä—ã –≤–∞–ª–∏–¥–Ω—ã
- ‚úÖ Leaflet –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ `isMapReady && this.map`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∫–ª—é—á–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ dev-—Ä–µ–∂–∏–º–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `isLeafletCssLoaded` –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–µ—Ä–µ–¥ `initialize()`
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `LeafletMapProvider.initialize()`
- –í—Å–µ `console.log` –æ–±—ë—Ä–Ω—É—Ç—ã –≤ `if (process.env.NODE_ENV === 'development')`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

---

### –ë–ª–æ–∫ 4. invalidateSize() ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
- ‚úÖ –ó–∞—Ç–µ–º –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ ‚Äî —á–µ—Ä–µ–∑ `requestAnimationFrame + setTimeout(0)`
- ‚úÖ –ó–∞—Ç–µ–º –µ—â—ë —Ä–∞–∑ ‚Äî –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- ‚úÖ –ü–æ—Å–ª–µ `invalidateSize` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setBounds()`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤: —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `setIsMapReady(true)`
- –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤: –≤–Ω—É—Ç—Ä–∏ `requestAnimationFrame(() => setTimeout(() => {...}, 0))`
- –¢—Ä–µ—Ç–∏–π –≤—ã–∑–æ–≤: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 150ms)
- `setBounds()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `isSizeValidated === true`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 5. fitBounds() (–∞–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ) ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ü–µ—Ä–µ–¥ `fitBounds` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è bounds:
  - ‚úÖ `north > south`
  - ‚úÖ `east > west`
  - ‚úÖ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ `undefined/null`
  - ‚úÖ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è `Number.isFinite()`
- ‚úÖ `fitBounds` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `invalidateSize`
- ‚úÖ –ù–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `fitBounds` –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `LeafletMapProvider.setBounds()`:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `null/undefined`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –∏ `Number.isFinite()`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ (`north > south`, `east > west`)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ bounds
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å `previousBoundsRef` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –í—ã–∑–æ–≤ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `isSizeValidated === true`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 6. –ú–∞—Ä–∫–µ—Ä—ã ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `isMapReady && isSizeValidated`
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤ (–æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º)
- ‚úÖ –£ transfer-–º–∞—Ä–∫–µ—Ä–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `zIndex`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞: `if (!isMapReady || !isSizeValidated) return;`
- –û—á–∏—Å—Ç–∫–∞: `for (const markerId of markersRef.current.keys()) { provider.removeMarker(markerId); }`
- `zIndexOffset: options?.isTransfer ? 1000 : 0` –≤ `LeafletMapProvider.addMarker()`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 7. –ü–æ–ª–∏–ª–∏–Ω–∏–∏ ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –†–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
- ‚úÖ –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –ª–∏–Ω–∏–∏
- ‚úÖ –¶–≤–µ—Ç, —Ç–æ–ª—â–∏–Ω–∞, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞: `if (!isMapReady || !isSizeValidated) return;`
- –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º: `polylinesRef.current.clear()`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getPolylineStyle()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—Ç–∏–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 8. Tile Provider ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä ‚Äî OpenStreetMap France
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã: `subdomains`, `detectRetina`, `errorTileUrl`
- ‚úÖ –ü—Ä–∏ 5 –æ—à–∏–±–∫–∞—Ö ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ CartoDB
- ‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è `invalidateSize`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- URL: `https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png`
- –û–ø—Ü–∏–∏: `subdomains: ['a', 'b', 'c']`, `detectRetina: true`, `errorTileUrl`
- –°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫: `MAX_TILE_ERRORS = 5`
- Fallback: CartoDB Voyager
- `invalidateSize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ fallback

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

### –ë–ª–æ–∫ 9. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ù–µ—Ç –ª–∏—à–Ω–∏—Ö `useEffect` –≤—ã–∑–æ–≤–æ–≤ (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã)
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –∫–∞—Ä—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–º–µ–º–æ–∏–∑–∞—Ü–∏—è)
- ‚úÖ –ö–ª—é—á –≤ `RouteMapSwitcher` —Å—Ç–∞–±–∏–ª—å–Ω—ã–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `useEffect` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- `useMemo` –∏ `useCallback` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤
- Key –≤—Å–µ–≥–¥–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π: `route-map-${providerType}-${currentRoute.routeId}-${currentRouteIndex}`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

---

### –ë–ª–æ–∫ 10. –û—à–∏–±–∫–∏ ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∫–∞—Ä—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ UI
- ‚úÖ –û—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞¬ª

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫: `initError`, `mapDataError`
- –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞¬ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É:
  - –°–±—Ä–æ—Å `initError`, `isMapReady`, `isSizeValidated`
  - –°–±—Ä–æ—Å `isLeafletCssLoaded`
  - –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã: `mapProviderRef.current.destroy()`

**–ü—Ä–æ–±–ª–µ–º:** –ù–µ—Ç

---

## –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∞—É–¥–∏—Ç–∞.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production —Ä–µ–∂–∏–º–µ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –ù–∏–∑–∫–∞—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í `RouteMap` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –±—ã–ª–∏ `console.log` –≤—ã–∑–æ–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ production —Ä–µ–∂–∏–º–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–í—Å–µ `console.log` –æ–±—ë—Ä–Ω—É—Ç—ã –≤ –ø—Ä–æ–≤–µ—Ä–∫—É `if (process.env.NODE_ENV === 'development')`.

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`

**–°—Ç—Ä–æ–∫–∏:** 347, 367, 401

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π key –≤ RouteMapSwitcher ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í `RouteMapSwitcher` –ø—Ä–∏ `preserveMapPosition === true` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π key `'preserve'`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
Key –≤—Å–µ–≥–¥–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π: `route-map-${providerType}-${currentRoute.routeId}-${currentRouteIndex}`. `preserveMapPosition` –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∫–∞—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ `RouteMap`, –∞ –Ω–µ –Ω–∞ key –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-switcher.tsx`

**–°—Ç—Ä–æ–∫–∞:** 172

---

## –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1:** –£–±—Ä–∞—Ç—å console.log –∏–∑ production
- ‚úÖ –í—Å–µ `console.log` –æ–±—ë—Ä–Ω—É—Ç—ã –≤ `if (process.env.NODE_ENV === 'development')`
- ‚úÖ –§–∞–π–ª: `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`
- ‚úÖ –°—Ç—Ä–æ–∫–∏: 347, 367, 401

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å key –≤ RouteMapSwitcher
- ‚úÖ Key –≤—Å–µ–≥–¥–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π: `route-map-${providerType}-${currentRoute.routeId}-${currentRouteIndex}`
- ‚úÖ –§–∞–π–ª: `frontend/src/modules/routes/features/route-map/ui/route-map-switcher.tsx`
- ‚úÖ –°—Ç—Ä–æ–∫–∞: 172

---

## –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### –°—Ç–∞—Ç—É—Å: ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£ ‚Äî 100%**

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ 40 –∏–∑ 40 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (100%)
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç—ã –æ–±–µ—Å–ø–µ—á–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –í—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

**–¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º (–≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production —Ä–µ–∂–∏–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
2. ‚úÖ Key –≤ RouteMapSwitcher –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£ ‚Äî 100%**

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ú–æ–¥—É–ª—å Leaflet-–∫–∞—Ä—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–æ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å 2 –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
3. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

---

**–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2024  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É ‚Äî 100% (–≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

