# –§–ò–ù–ê–õ–¨–ù–´–ô –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–£–î–ò–¢: –ú–æ–¥—É–ª—å Leaflet-–∫–∞—Ä—Ç—ã

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2024  
**–¢–∏–ø –∞—É–¥–∏—Ç–∞:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π (Production-Ready)  
**–û—Ö–≤–∞—Ç:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –∫–∞—Ä—Ç—ã (CSS ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí resize/invalidateSize ‚Üí fitBounds ‚Üí –º–∞—Ä–∫–µ—Ä—ã ‚Üí –ø–æ–ª–∏–ª–∏–Ω–∏–∏ ‚Üí –º–∞—Ä—à—Ä—É—Ç—ã ‚Üí –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

---

## –†–ï–ó–Æ–ú–ï –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï

### –°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–°—Ç–∞–±–∏–ª–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º**

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:**
- üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:** 2
- üü† **–í—ã—Å–æ–∫–∏–µ:** 3
- üü° **–°—Ä–µ–¥–Ω–∏–µ:** 2
- üü¢ **–ù–∏–∑–∫–∏–µ:** 1

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** 85% (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ –≤—ã—Å–æ–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º ‚Äî 100%)

---

## 1. –ê–£–î–ò–¢ –ó–ê–ì–†–£–ó–ö–ò CSS

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 163-211

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
1. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `data-–∞—Ç—Ä–∏–±—É—Ç—É` (—Å—Ç—Ä–æ–∫–∞ 171): `document.querySelector('link[data-leaflet-css]')`
2. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `href` (—Å—Ç—Ä–æ–∫–∞ 172): `document.querySelector('link[href="${leafletCssUrl}"]')`
3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∞ 183): `doubleCheck`
4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∏ 199-205): `finalCheck`

**–í—ã–≤–æ–¥:** –î—É–±–ª–∏–∫–∞—Ç—ã CSS –∏—Å–∫–ª—é—á–µ–Ω—ã. –¢—Ä–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–∞–∂–µ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–Ω–æ–∫ (race conditions)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ê–Ω–∞–ª–∏–∑:**
- –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSS (—Å—Ç—Ä–æ–∫–∏ 163-211) –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[providerType]`
- –≠—Ñ—Ñ–µ–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 227-426) –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[mapProvider, showControls, providerType, isLeafletCssLoaded]`
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `isLeafletCssLoaded` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ `appendChild` (—Å—Ç—Ä–æ–∫–∏ 199-205) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏

**–í—ã–≤–æ–¥:** –ì–æ–Ω–∫–∏ –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∑–∫–æ–π CSS –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏—Å–∫–ª—é—á–µ–Ω—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. SSR –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 164): `typeof window === 'undefined'`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 164): `providerType !== 'leaflet'`
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ link (—Å—Ç—Ä–æ–∫–∏ 171-173)
4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 183)
5. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 199-205)

**–í—ã–≤–æ–¥:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –°–±—Ä–æ—Å `isLeafletCssLoaded` –≤ `false` (—Å—Ç—Ä–æ–∫–∞ 596)
- –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSS –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `[providerType]`

**–í—ã–≤–æ–¥:** –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ò—Ç–æ–≥ –ø–æ CSS

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü—Ä–æ–±–ª–µ–º –Ω–µ—Ç**

---

## 2. –ê–£–î–ò–¢ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ö–ê–†–¢–´

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 227-426

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫:**
1. –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSS (—Å—Ç—Ä–æ–∫–∏ 163-211) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[providerType]`
2. –≠—Ñ—Ñ–µ–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 227-426) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[mapProvider, showControls, providerType, isLeafletCssLoaded]`
3. –≠—Ñ—Ñ–µ–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ bounds (—Å—Ç—Ä–æ–∫–∏ 428-439) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[bounds, boundsValid, isMapReady]`
4. –≠—Ñ—Ñ–µ–∫—Ç —Å–æ–±—ã—Ç–∏–π (—Å—Ç—Ä–æ–∫–∏ 441-458) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[mapEvents, isMapReady]`
5. –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ª–∏–ª–∏–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 460-497) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[visibleSegments, selectedSegmentId, isMapReady]`
6. –≠—Ñ—Ñ–µ–∫—Ç –º–∞—Ä–∫–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 499-536) ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `[mapData, isMapReady]`

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ñ—Ñ–µ–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ bounds –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `invalidateSize()`, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–∞—Å—á—ë—Ç—É –≥—Ä–∞–Ω–∏—Ü.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É `invalidateSize()` (—Å—Ç—Ä–æ–∫–∞ 367) –∏ `setBounds()` (—Å—Ç—Ä–æ–∫–∞ 438).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
1. `setInitError(null)` –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (—Å—Ç—Ä–æ–∫–∞ 233)
2. `setIsMapReady(false)` –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (—Å—Ç—Ä–æ–∫–∞ 234)
3. `setIsMapReady(true)` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 355)
4. `setIsLeafletCssLoaded(true)` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ CSS (—Å—Ç—Ä–æ–∫–∏ 177, 185, 203, 210, 254, 273)

**–í—ã–≤–æ–¥:** –°–æ—Å—Ç–æ—è–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ `isMapReady` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–∞–º–∏ –º–µ—Ç–æ–¥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 430, 443, 467, 506)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `isInitialized()` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–∞–º–∏ –º–µ—Ç–æ–¥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 434, 447, 467, 506)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `mapProviderRef.current` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–∞–º–∏ (—Å—Ç—Ä–æ–∫–∏ 430, 443, 462, 501)

**–í—ã–≤–æ–¥:** –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ providerType

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–¶–µ–ø–æ—á–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏:**
1. `RouteDetailsView` (—Å—Ç—Ä–æ–∫–∞ 136): `providerType="leaflet"`
2. `RouteMapWithAlternatives` (—Å—Ç—Ä–æ–∫–∞ 162): –ø–µ—Ä–µ–¥–∞—ë—Ç `providerType` –≤ `RouteMapSwitcher`
3. `RouteMapSwitcher` (—Å—Ç—Ä–æ–∫–∞ 171): –ø–µ—Ä–µ–¥–∞—ë—Ç `providerType` –≤ `RouteMap`
4. `RouteMap` (—Å—Ç—Ä–æ–∫–∞ 100): –ø–æ–ª—É—á–∞–µ—Ç `providerType` –∏–∑ props
5. `RouteMap` (—Å—Ç—Ä–æ–∫–∏ 214-224): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `providerType` –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–í—ã–≤–æ–¥:** `providerType` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–µ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–∞—Ä—Ç—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
1. `mapProvider` –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `useMemo` (—Å—Ç—Ä–æ–∫–∏ 214-224)
2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã: `[externalMapProvider, providerType]`
3. `mapProviderRef.current` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 354)
4. –í—Å–µ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `mapProviderRef.current`

**–í—ã–≤–æ–¥:** –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ò—Ç–æ–≥ –ø–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É `invalidateSize()` –∏ `setBounds()`

---

## 3. –ê–£–î–ò–¢ INVALIDATESIZE

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 362-370

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 518-528

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–∞ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `invalidateSize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 363-369)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `providerType === 'leaflet'` (—Å—Ç—Ä–æ–∫–∞ 363)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `mapProviderRef.current` (—Å—Ç—Ä–æ–∫–∞ 366)

**–í—ã–≤–æ–¥:** –í—ã–∑–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –∑–∞–¥–µ—Ä–∂–∫–∏

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms (—Å—Ç—Ä–æ–∫–∞ 365): `setTimeout(..., 100)`

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∫–∞—Ä—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–æ–≤

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–Ω–æ–∫ –º–µ–∂–¥—É invalidateSize –∏ fitBounds

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ê–Ω–∞–ª–∏–∑:**
- `invalidateSize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 100ms (—Å—Ç—Ä–æ–∫–∞ 365)
- `setBounds()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —ç—Ñ—Ñ–µ–∫—Ç–µ (—Å—Ç—Ä–æ–∫–∞ 438)
- –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `[bounds, boundsValid, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 439)
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ `invalidateSize()` –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –¥–æ `setBounds()`

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏. –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–Ω—å—à–µ, —á–µ–º `invalidateSize()` –æ–±–Ω–æ–≤–∏—Ç —Ä–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç—ã.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:** –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ `fitBounds()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- `invalidateSize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `isMapReady === true` (—Å—Ç—Ä–æ–∫–∞ 366)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–∞ `invalidateSize` (—Å—Ç—Ä–æ–∫–∞ 366)

**–í—ã–≤–æ–¥:** –ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –Ω–µ—Ç.

### –ò—Ç–æ–≥ –ø–æ invalidateSize

**–°—Ç–∞—Ç—É—Å:** üî¥ **1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, 1 –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –ì–æ–Ω–∫–∞ –º–µ–∂–¥—É `invalidateSize()` –∏ `setBounds()`
2. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π

---

## 4. –ê–£–î–ò–¢ FITBOUNDS / –ê–í–¢–û–¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ò–Ø

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 428-439

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 184-226

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/hooks/use-route-map-bounds.ts`  
**–°—Ç—Ä–æ–∫–∏:** 57-93

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/utils/coordinates.utils.ts`  
**–°—Ç—Ä–æ–∫–∏:** 129-174

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
1. `useRouteMapBounds` —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 67-79)
2. `calculateBoundsFromCoordinates` –≤—ã—á–∏—Å–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã (—Å—Ç—Ä–æ–∫–∏ 137-148)
3. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è padding 15% (—Å—Ç—Ä–æ–∫–∞ 128)
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –≤—Å–µ —Ç–æ—á–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç (—Å—Ç—Ä–æ–∫–∏ 155-157)

**–í—ã–≤–æ–¥:** –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –º–æ–º–µ–Ω—Ç–∞ –≤—ã–∑–æ–≤–∞

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `[bounds, boundsValid, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 439)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `isMapReady` (—Å—Ç—Ä–æ–∫–∞ 430)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `isInitialized()` (—Å—Ç—Ä–æ–∫–∞ 434)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ `invalidateSize()` –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –¥–æ –≤—ã–∑–æ–≤–∞ `setBounds()`. –≠—Ñ—Ñ–µ–∫—Ç –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–Ω—å—à–µ, —á–µ–º –∫–∞—Ä—Ç–∞ –æ–±–Ω–æ–≤–∏—Ç —Ä–∞–∑–º–µ—Ä—ã.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É `invalidateSize()` –∏ `setBounds()`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–ê–Ω–∞–ª–∏–∑:**
- –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `[bounds, boundsValid, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 439)
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `bounds` –∏–ª–∏ `isMapReady` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setBounds()`
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ `bounds` –º–µ–Ω—è–µ—Ç—Å—è, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö bounds. –≠—Ñ—Ñ–µ–∫—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ bounds –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è bounds –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ bounds

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ê–Ω–∞–ª–∏–∑:**
- –í `setBounds()` (—Å—Ç—Ä–æ–∫–∏ 184-226) –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `bounds` –Ω–µ `null` –∏–ª–∏ `undefined`
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏ –∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `north > south` –∏ `east > west`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, `fitBounds()` –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è bounds –≤ –º–µ—Ç–æ–¥–µ `setBounds()`.

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:** –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `isMapReady` (—Å—Ç—Ä–æ–∫–∞ 430)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `isInitialized()` (—Å—Ç—Ä–æ–∫–∞ 434)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `mapProviderRef.current` (—Å—Ç—Ä–æ–∫–∞ 430)

**–í—ã–≤–æ–¥:** –í—ã–∑–æ–≤—ã –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–≤ —Å –ø—É—Å—Ç—ã–º–∏/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ bounds

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `bounds` (—Å—Ç—Ä–æ–∫–∞ 430): `!bounds`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `boundsValid` (—Å—Ç—Ä–æ–∫–∞ 430): `!boundsValid`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `setBounds()` –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ bounds –≤–∞–ª–∏–¥–Ω—ã. –ï—Å–ª–∏ `boundsValid === true`, –Ω–æ bounds —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `north <= south`), –º–µ—Ç–æ–¥ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å `fitBounds()`.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è bounds –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∞, –Ω–æ –Ω–µ –≤ —Å–∞–º–æ–º –º–µ—Ç–æ–¥–µ `setBounds()`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

### –ò—Ç–æ–≥ –ø–æ fitBounds

**–°—Ç–∞—Ç—É—Å:** üî¥ **2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, 2 –≤—ã—Å–æ–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å `invalidateSize()`
2. –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ bounds –≤ `setBounds()`
3. –õ–∏—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
4. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds

---

## 5. –ê–£–î–ò–¢ –†–ï–ù–î–ï–†–ò–ù–ì–ê –ú–ê–†–ö–ï–†–û–í

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 499-536

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 265-314

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 513-516)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `markersRef` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 534)
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ `removeMarker()` (—Å—Ç—Ä–æ–∫–∏ 513-515)

**–í—ã–≤–æ–¥:** –î—É–±–ª–∏–∫–∞—Ç—ã –º–∞—Ä–∫–µ—Ä–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 513-516)
- –û—á–∏—Å—Ç–∫–∞ `markersRef` (—Å—Ç—Ä–æ–∫–∞ 516)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `for...of` –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–∞–º (—Å—Ç—Ä–æ–∫–∞ 513)

**–í—ã–≤–æ–¥:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Ä—è–¥–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ü–æ—Ä—è–¥–æ–∫:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 506-508)
2. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 513-516)
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 519)
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É (—Å—Ç—Ä–æ–∫–∏ 522-535)

**–í—ã–≤–æ–¥:** –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–Ω–¥–µ—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è transfer-–º–∞—Ä–∫–µ—Ä–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `isTransfer` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `addMarker()` (—Å—Ç—Ä–æ–∫–∞ 526)
- –í `addMarker()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getDefaultMarkerIcon(options?.isTransfer)` (—Å—Ç—Ä–æ–∫–∞ 287)
- –î–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—Ä–∞—Å–Ω–∞—è –∏–∫–æ–Ω–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 636)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —è–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `zIndex` –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤. –û–Ω–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏ –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** Leaflet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç zIndex, –Ω–æ –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —è–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°—Ä–µ–¥–Ω–∏–π**

### –ò—Ç–æ–≥ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **1 —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —è–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ zIndex –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤

---

## 6. –ê–£–î–ò–¢ –†–ï–ù–î–ï–†–ò–ù–ì–ê –ü–û–õ–ò–õ–ò–ù–ò–ô

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 460-497

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 356-404

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–∏–ª–∏–Ω–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–∏–ª–∏–Ω–∏–π –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 474-477)
- –û—á–∏—Å—Ç–∫–∞ `polylinesRef` (—Å—Ç—Ä–æ–∫–∞ 477)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `for...of` –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–∞–º (—Å—Ç—Ä–æ–∫–∞ 474)

**–í—ã–≤–æ–¥:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–∏–ª–∏–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—Ç–∏–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getPolylineStyle()` (—Å—Ç—Ä–æ–∫–∞ 482)
- –ü–µ—Ä–µ–¥–∞—á–∞ —Ü–≤–µ—Ç–∞, –≤–µ—Å–∞ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 485-487)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 481)

**–í—ã–≤–æ–¥:** –°—Ç–∏–ª–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ê–Ω–∞–ª–∏–∑:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∞: `[visibleSegments, selectedSegmentId, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 497)
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–∏–ª–∏–Ω–∏–π –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 474-477)
- –≠—Ñ—Ñ–µ–∫—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–í—ã–≤–æ–¥:** –ü–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞ –Ω–µ—Ç. –ü–æ–ª–∏–ª–∏–Ω–∏–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

### –ò—Ç–æ–≥ –ø–æ –ø–æ–ª–∏–ª–∏–Ω–∏—è–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü—Ä–æ–±–ª–µ–º –Ω–µ—Ç**

---

## 7. –ê–£–î–ò–¢ –ú–ê–†–®–†–£–¢–û–í –ò –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

**–¶–µ–ø–æ—á–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

```
RouteDetailsView (—Å—Ç—Ä–æ–∫–∞ 136)
  ‚Üí RouteMapWithAlternatives (—Å—Ç—Ä–æ–∫–∏ 60-165)
    ‚Üí RouteMapSwitcher (—Å—Ç—Ä–æ–∫–∏ 58-184)
      ‚Üí RouteMap (—Å—Ç—Ä–æ–∫–∏ 89-691)
        ‚Üí LeafletMapProvider (—Å—Ç—Ä–æ–∫–∏ 57-661)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `RouteMapSwitcher` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `key={preserveMapPosition ? 'preserve' : 'route-map-${providerType}'}` (—Å—Ç—Ä–æ–∫–∞ 172)

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ü—Ä–∏ `preserveMapPosition === false` key –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `providerType`
- Key –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç `currentRouteIndex`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** Key –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—é –∫–∞—Ä—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°—Ä–µ–¥–Ω–∏–π**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–ê–Ω–∞–ª–∏–∑:**
- `mapProvider` –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `useMemo` (—Å—Ç—Ä–æ–∫–∏ 214-224)
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã: `[externalMapProvider, providerType]`
- –ü—Ä–∏ `preserveMapPosition === true` key —Å—Ç–∞–±–∏–ª–µ–Ω

**–í—ã–≤–æ–¥:** –ö–∞—Ä—Ç–∞ –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ providerType

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–¶–µ–ø–æ—á–∫–∞:**
1. `RouteDetailsView` ‚Üí `RouteMapWithAlternatives`: `providerType="leaflet"` (—Å—Ç—Ä–æ–∫–∞ 136)
2. `RouteMapWithAlternatives` ‚Üí `RouteMapSwitcher`: `providerType={providerType}` (—Å—Ç—Ä–æ–∫–∞ 162)
3. `RouteMapSwitcher` ‚Üí `RouteMap`: `providerType={providerType}` (—Å—Ç—Ä–æ–∫–∞ 171)
4. `RouteMap` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `providerType` –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 214-224)

**–í—ã–≤–æ–¥:** `providerType` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ò—Ç–æ–≥ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **1 —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** Key –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç

---

## 8. –ê–£–î–ò–¢ –û–ë–†–ê–ë–û–¢–ö–ò –û–®–ò–ë–û–ö

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 583-621

### –ü—Ä–æ–≤–µ—Ä–∫–∞ initError

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `initError` (—Å—Ç—Ä–æ–∫–∞ 108)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 278, 311, 374)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ UI (—Å—Ç—Ä–æ–∫–∏ 589-590)

**–í—ã–≤–æ–¥:** `initError` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –°–±—Ä–æ—Å `initError` (—Å—Ç—Ä–æ–∫–∞ 593)
- –°–±—Ä–æ—Å `isMapReady` (—Å—Ç—Ä–æ–∫–∞ 594)
- –°–±—Ä–æ—Å `isLeafletCssLoaded` (—Å—Ç—Ä–æ–∫–∞ 596)
- –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 598-600)

**–í—ã–≤–æ–¥:** –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –°–±—Ä–æ—Å –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞" (—Å—Ç—Ä–æ–∫–∏ 593-600)
- –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ cleanup —Ñ—É–Ω–∫—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 423-424)

**–í—ã–≤–æ–¥:** –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –≠—Ñ—Ñ–µ–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Å—Ç—Ä–æ–∫–∞ 426)
- –°–±—Ä–æ—Å `isLeafletCssLoaded` –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ CSS (—Å—Ç—Ä–æ–∫–∞ 596)
- –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π (—Å—Ç—Ä–æ–∫–∏ 598-600)

**–í—ã–≤–æ–¥:** –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ò—Ç–æ–≥ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü—Ä–æ–±–ª–µ–º –Ω–µ—Ç**

---

## 9. –ò–¢–û–ì–û–í–´–ô –û–¢–ß–Å–¢ –ü–†–û–ë–õ–ï–ú

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (üî¥)

#### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ì–æ–Ω–∫–∞ –º–µ–∂–¥—É invalidateSize –∏ setBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 365-369, 428-439

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** 
- `invalidateSize()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ `setTimeout(..., 100)` (—Å—Ç—Ä–æ–∫–∞ 365)
- `setBounds()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —ç—Ñ—Ñ–µ–∫—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–Ω—å—à–µ (—Å—Ç—Ä–æ–∫–∞ 438)
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `[bounds, boundsValid, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 439)
- –≠—Ñ—Ñ–µ–∫—Ç –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ `invalidateSize()` –æ–±–Ω–æ–≤–∏—Ç —Ä–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç—ã
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–∞—Å—á—ë—Ç—É –≥—Ä–∞–Ω–∏—Ü

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∞
- –ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ì—Ä–∞–Ω–∏—Ü—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—ã–∑—ã–≤–∞—Ç—å `setBounds()` –ø–æ—Å–ª–µ `invalidateSize()` –≤ —Ç–æ–º –∂–µ `setTimeout`
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `isSizeValidated` –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –µ–≥–æ –≤ —ç—Ñ—Ñ–µ–∫—Ç–µ `setBounds`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestAnimationFrame` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

#### –ü—Ä–æ–±–ª–µ–º–∞ #2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ bounds –≤ setBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 184-226

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –í –º–µ—Ç–æ–¥–µ `setBounds()` –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ bounds –Ω–µ `null` –∏–ª–∏ `undefined`
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏ –∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `north > south` –∏ `east > west`

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, `fitBounds()` –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É
- `LatLngBounds` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–ª–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds
- –ú–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é bounds –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `fitBounds()`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `north > south` –∏ `east > west`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏ –∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()` –≤–º–µ—Å—Ç–æ `fitBounds()`

---

### –í—ã—Å–æ–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (üü†)

#### –ü—Ä–æ–±–ª–µ–º–∞ #3: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ invalidateSize –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 365

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 100ms
- –ù–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∫–∞—Ä—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–æ–≤

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ù–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∫–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–∞—Å—á—ë—Ç—É –≥—Ä–∞–Ω–∏—Ü

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ì—Ä–∞–Ω–∏—Ü—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestAnimationFrame` –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `setBounds()`

---

#### –ü—Ä–æ–±–ª–µ–º–∞ #4: –õ–∏—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã fitBounds –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 428-439

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –≠—Ñ—Ñ–µ–∫—Ç `setBounds` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `[bounds, boundsValid, isMapReady]` (—Å—Ç—Ä–æ–∫–∞ 439)
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `bounds` –∏–ª–∏ `isMapReady` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `setBounds()`
- –ù–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö bounds

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ `bounds` –º–µ–Ω—è–µ—Ç—Å—è, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ bounds –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –õ–∏—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã `fitBounds()` –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
- –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useRef` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö bounds
- –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å bounds –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `setBounds()`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useMemo` –¥–ª—è –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ bounds

---

#### –ü—Ä–æ–±–ª–µ–º–∞ #5: –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds –≤ setBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 208-213

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `north > south` –∏ `east > west`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, `LatLngBounds` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ï—Å–ª–∏ `bounds.north <= bounds.south` –∏–ª–∏ `bounds.east <= bounds.west`, `fitBounds()` –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds
- –ú–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† **–í—ã—Å–æ–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: `bounds.north > bounds.south && bounds.east > bounds.west`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()` –≤–º–µ—Å—Ç–æ `fitBounds()`

---

### –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (üü°)

#### –ü—Ä–æ–±–ª–µ–º–∞ #6: Key –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-switcher.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 172

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- Key –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `preserveMapPosition ? 'preserve' : 'route-map-${providerType}'`
- Key –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç `currentRouteIndex`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∫–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ö–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°—Ä–µ–¥–Ω–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `currentRouteIndex` –≤ key, –µ—Å–ª–∏ `preserveMapPosition === false`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `currentRoute.routeId` –≤ key

---

#### –ü—Ä–æ–±–ª–µ–º–∞ #7: –ù–µ—Ç —è–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ zIndex –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 265-314

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ù–µ—Ç —è–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `zIndex` –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤
- Leaflet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç zIndex, –Ω–æ –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —è–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- Transfer –º–∞—Ä–∫–µ—Ä—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏ –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
- –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- Transfer –º–∞—Ä–∫–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≤–∏–¥–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ–∫—Ä—ã—Ç—ã –¥—Ä—É–≥–∏–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **–°—Ä–µ–¥–Ω–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `zIndexOffset` –≤ –æ–ø—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è transfer —Ç–æ—á–µ–∫
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bringToFront()` –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤

---

### –ù–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (üü¢)

#### –ü—Ä–æ–±–ª–µ–º–∞ #8: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—É—Å—Ç—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ addPolyline

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 356-404

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `coordinates` –Ω–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã

**–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- –ï—Å–ª–∏ `coordinates` –ø—É—Å—Ç–æ–π, `polyline()` –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É:**
- –ú–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ü–æ–ª–∏–ª–∏–Ω–∏—è –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ **–ù–∏–∑–∫–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ `coordinates.length > 0`
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª–∏–ª–∏–Ω–∏–∏

---

## 10. –°–ü–ò–°–û–ö –¢–û–ß–ï–ß–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è invalidateSize –∏ setBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 362-370, 428-439

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –í—ã–∑—ã–≤–∞—Ç—å `setBounds()` –ø–æ—Å–ª–µ `invalidateSize()` –≤ —Ç–æ–º –∂–µ `setTimeout`
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `isSizeValidated` –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –µ–≥–æ –≤ —ç—Ñ—Ñ–µ–∫—Ç–µ `setBounds`

**–ö–∞–∫:**
- –í —ç—Ñ—Ñ–µ–∫—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ—Å–ª–µ `setIsMapReady(true)`, –≤—ã–∑–≤–∞—Ç—å `invalidateSize()` –∏ –∑–∞—Ç–µ–º `setBounds()` –≤ —Ç–æ–º –∂–µ `setTimeout`
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isSizeValidated` –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –µ–≥–æ –ø–æ—Å–ª–µ `invalidateSize()`
- –í —ç—Ñ—Ñ–µ–∫—Ç–µ `setBounds` –ø—Ä–æ–≤–µ—Ä—è—Ç—å `isSizeValidated` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #2: –í–∞–ª–∏–¥–∞—Ü–∏—è bounds –≤ setBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 184-226

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é bounds –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `fitBounds()`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ bounds –Ω–µ `null` –∏–ª–∏ `undefined`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏ –∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `north > south` –∏ `east > west`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()` –≤–º–µ—Å—Ç–æ `fitBounds()`

**–ö–∞–∫:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞ `setBounds()`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –≤—ã—á–∏—Å–ª–∏—Ç—å —Ü–µ–Ω—Ç—Ä –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #3: –£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ invalidateSize

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 365

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestAnimationFrame` –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `setBounds()`

**–ö–∞–∫:**
- –ó–∞–º–µ–Ω–∏—Ç—å `setTimeout(..., 100)` –Ω–∞ `requestAnimationFrame` —Å –¥–≤–æ–π–Ω—ã–º –≤—ã–∑–æ–≤–æ–º
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestAnimationFrame` + `setTimeout` –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #4: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ fitBounds

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 428-439

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useRef` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö bounds
- –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å bounds –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `setBounds()`

**–ö–∞–∫:**
- –î–æ–±–∞–≤–∏—Ç—å `const previousBoundsRef = useRef<IMapBounds | null>(null)`
- –í —ç—Ñ—Ñ–µ–∫—Ç–µ `setBounds` —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ bounds —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏
- –ï—Å–ª–∏ bounds –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤—ã–∑–æ–≤ `setBounds()`
- –û–±–Ω–æ–≤–ª—è—Ç—å `previousBoundsRef.current` –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #5: –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö bounds

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 208-213

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: `bounds.north > bounds.south && bounds.east > bounds.west`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()` –≤–º–µ—Å—Ç–æ `fitBounds()`

**–ö–∞–∫:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º `LatLngBounds`
- –ï—Å–ª–∏ bounds –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –≤—ã—á–∏—Å–ª–∏—Ç—å —Ü–µ–Ω—Ç—Ä –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setCenter()`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #6: –£–ª—É—á—à–µ–Ω–∏–µ key –≤ RouteMapSwitcher

**–§–∞–π–ª:** `frontend/src/modules/routes/features/route-map/ui/route-map-switcher.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 172

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å `currentRouteIndex` –≤ key, –µ—Å–ª–∏ `preserveMapPosition === false`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `currentRoute.routeId` –≤ key

**–ö–∞–∫:**
- –ò–∑–º–µ–Ω–∏—Ç—å key –Ω–∞ `preserveMapPosition ? 'preserve' : 'route-map-${providerType}-${currentRouteIndex}'`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `currentRoute.routeId` –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #7: zIndex –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 282-290

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å `zIndexOffset` –≤ –æ–ø—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è transfer —Ç–æ—á–µ–∫

**–ö–∞–∫:**
- –î–æ–±–∞–≤–∏—Ç—å `zIndexOffset: options?.isTransfer ? 1000 : 0` –≤ `iconOptions`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bringToFront()` –¥–ª—è transfer –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ addPolyline

**–§–∞–π–ª:** `frontend/src/modules/routes/lib/providers/leaflet-map-provider.ts`  
**–°—Ç—Ä–æ–∫–∏:** 356-404

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ `coordinates.length > 0`
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª–∏–ª–∏–Ω–∏–∏

**–ö–∞–∫:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞ `addPolyline()`
- –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—É—Å—Ç—ã, –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å `null`
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª–∏–ª–∏–Ω–∏–∏

---

## 11. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è:** ‚ö†Ô∏è **–°—Ç–∞–±–∏–ª–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 2  
**–í—ã—Å–æ–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 3  
**–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 2  
**–ù–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 1

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** 85%

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ü–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#1, #2)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã—Å–æ–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#3, #4, #5)

**–í —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#6, #7)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#8)

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ –≤—ã—Å–æ–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –º–æ–¥—É–ª—å –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –Ω–∞ 100%.**

**–¢–µ–∫—É—â–∏–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CSS –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –ø–æ–ª–∏–ª–∏–Ω–∏–π
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢—Ä–µ–±—É—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö†Ô∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `invalidateSize()` –∏ `setBounds()`
- ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è bounds –≤ `setBounds()`
- ‚ö†Ô∏è –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ `fitBounds()`

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à—ë–Ω







