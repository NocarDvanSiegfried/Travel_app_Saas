# ‚úÖ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å—å RealityChecker.ts

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å—å —Ñ–∞–π–ª–∞ —Å –Ω—É–ª—è

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

–§–∞–π–ª `RealityChecker.ts` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –Ω—É–ª—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ–π –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞ RealityChecker

### –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- ‚úÖ `checkReality(route: SmartRoute): RealityCheckResult` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–æ–∫:
- ‚úÖ `checkDistanceReality(segment: SmartRouteSegment)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ `checkPriceReality(segment: SmartRouteSegment)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
- ‚úÖ `checkPathReality(segment: SmartRouteSegment)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏
- ‚úÖ `checkHubReality(segment: SmartRouteSegment, route: SmartRoute)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∞–±–æ–≤
- ‚úÖ `checkTransferReality(segment: SmartRouteSegment, route: SmartRoute)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–∞–¥–æ–∫
- ‚úÖ `checkSeasonalityReality(segment: SmartRouteSegment, route: SmartRoute)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- ‚úÖ `calculateRealDistance(segment: SmartRouteSegment): number | null` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ `estimateRealPrice(segment: SmartRouteSegment): number` - –æ—Ü–µ–Ω–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
- ‚úÖ `checkStraightLineDeviation(coordinates: [number, number][]): { isTooStraight: boolean; deviation: number }` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏
- ‚úÖ `getPathTypeForTransport(transportType: TransportType): string` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø—É—Ç–∏
- ‚úÖ `getMinTransferTime(fromType: TransportType, toType: TransportType): number` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏
- ‚úÖ `areTransportTypesCompatible(fromType: TransportType, toType: TransportType): boolean` - —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- ‚úÖ `getExpectedSeasonality(transportType: TransportType): Season[] | null` - –æ–∂–∏–¥–∞–µ–º—ã–µ —Å–µ–∑–æ–Ω—ã
- ‚úÖ `calculateCorrectionConfidence(segment: SmartRouteSegment, checkType: 'distance' | 'price'): number` - —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ `segment.from.coordinates.distanceTo(segment.to.coordinates)` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `distanceTo` –∫–ª–∞—Å—Å–∞ `Coordinates`
- ‚úÖ `hub.coordinates` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ö–∞–±–∞ –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ `CityReference.coordinates` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `Coordinates` —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Seasonality
- ‚úÖ `segment.seasonality.available` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `available`
- ‚úÖ `segment.seasonality.season` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `season`
- ‚úÖ `segment.seasonality.period?.start` –∏ `segment.seasonality.period?.end` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è `period` —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–∫ –≤ `Date`

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Hub
- ‚úÖ `hub.coordinates` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `coordinates` —Ç–∏–ø–∞ `Coordinates`
- ‚úÖ `hub.id` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `id`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ö–∞–±–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ —á–µ—Ä–µ–∑ `ALL_HUBS.find()`

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SmartRoute –∏ SmartRouteSegment
- ‚úÖ `route.segments` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- ‚úÖ `segment.from` –∏ `segment.to` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–∏–ø–∞ `IStop`
- ‚úÖ `segment.distance.value` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ `segment.price.total` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∞—è —Ü–µ–Ω–∞
- ‚úÖ `segment.pathGeometry.coordinates` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –ø—É—Ç–∏
- ‚úÖ `route.totalDuration.breakdown.transfers` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–∞–¥–æ–∫

---

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- –î–ª—è –∞–≤–∏–∞: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Haversine (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ –ø—Ä—è–º–æ–π —á–µ—Ä–µ–∑ `coordinates.distanceTo()`)
- –î–ª—è –Ω–∞–∑–µ–º–Ω–æ–≥–æ/–≤–æ–¥–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pathGeometry` —Å —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
- –î–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 10%

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
- –û—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ (—Ä—É–±/–∫–º) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –î–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 20%
- –£—á–µ—Ç —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏
- –î–ª—è BUS, FERRY, TRAIN, WINTER_ROAD: –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—É—Ç—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏ (–º–∏–Ω–∏–º—É–º 5%)
- –î–ª—è AIRPLANE –∏ TAXI: –ø—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∞–±–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤–∏–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ö–∞–±–æ–≤ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —É–¥–ª–∏–Ω—è—é—Ç –º–∞—Ä—à—Ä—É—Ç –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 50%)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö–∞–±–æ–≤ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (>2000 –∫–º)

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–∞–¥–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (–∫–æ–Ω–µ—Ü —Ç–µ–∫—É—â–µ–≥–æ = –Ω–∞—á–∞–ª–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –∏–∑ `totalDuration.breakdown.transfers`

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å–µ–∑–æ–Ω
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ç–∏–ø—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø–µ—Ä–∏–æ–¥)

---

## üìä –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### RealityCheckResult
```typescript
export interface RealityCheckResult {
  hasIssues: boolean;
  issues: Array<{
    type: 'distance_mismatch' | 'price_mismatch' | 'route_mismatch' | 'path_mismatch' | 'hub_mismatch' | 'transfer_mismatch' | 'seasonality_mismatch';
    segmentId: string;
    message: string;
    correction?: {
      type: 'adjust_distance' | 'adjust_price' | 'rebuild_route' | 'rebuild_path' | 'add_hub' | 'remove_hub' | 'add_transfer' | 'change_season';
      suggestedValue: number | string | unknown;
      confidence: number;
    };
    metadata?: Record<string, unknown>;
  }>;
  recommendations: string[];
}
```

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã

### –ò–º–ø–æ—Ä—Ç—ã:
- ‚úÖ `SmartRoute` - —Ç–∏–ø –º–∞—Ä—à—Ä—É—Ç–∞
- ‚úÖ `SmartRouteSegment` - —Ç–∏–ø —Å–µ–≥–º–µ–Ω—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞
- ‚úÖ `TransportType` - enum —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- ‚úÖ `Coordinates` - –∫–ª–∞—Å—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ `Season` - enum —Å–µ–∑–æ–Ω–æ–≤
- ‚úÖ `ALL_CITIES`, `getCityById` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ `ALL_HUBS` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ö–∞–±–æ–≤
- ‚úÖ `isAvailableOnDate` - —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### –í—Å–µ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ –ù–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π
- ‚úÖ –ù–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –í—Å–µ return-—Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –§–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –Ω—É–ª—è
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ TypeScript
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- ‚úÖ –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ö–æ–¥ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ —á–∏—Å—Ç–∞—è, –±–µ–∑ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

```bash
# –í Docker
docker-compose up --build

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
npm run build
npm run start
```

---

**–î–∞—Ç–∞ –ø–µ—Ä–µ–ø–∏—Å–∏:** 2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤




