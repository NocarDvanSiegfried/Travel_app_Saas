# ‚úÖ –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ TypeScript –≤ Backend

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. RealityChecker.ts ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤

#### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
- **`checkHubReality`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö–∞–±–æ–≤ –¥–ª—è –∞–≤–∏–∞-—Å–µ–≥–º–µ–Ω—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ö–∞–±–æ–≤ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ö–∞–±–æ–≤ (–Ω–µ —É–¥–ª–∏–Ω—è—é—Ç –º–∞—Ä—à—Ä—É—Ç –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 50%)
  - –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (>2000 –∫–º) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö–∞–±–æ–≤
  
- **`checkTransferReality`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–∞–¥–æ–∫ –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (–∫–æ–Ω–µ—Ü —Ç–µ–∫—É—â–µ–≥–æ = –Ω–∞—á–∞–ª–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏
  
- **`checkSeasonalityReality`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å–µ–∑–æ–Ω
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ç–∏–ø—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)

#### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- **`getMinTransferTime`** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- **`areTransportTypesCompatible`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏
- **`getExpectedSeasonality`** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–µ —Å–µ–∑–æ–Ω—ã –¥–ª—è —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

#### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã Record<TransportType, ...>:
- **`baseRates`** (—Å—Ç—Ä–æ–∫–∞ 327): –¥–æ–±–∞–≤–ª–µ–Ω `[TransportType.UNKNOWN]: 5.0`
- **`mapping`** –≤ `getPathTypeForTransport` (—Å—Ç—Ä–æ–∫–∞ 440): –¥–æ–±–∞–≤–ª–µ–Ω `[TransportType.UNKNOWN]: '–¥–æ—Ä–æ–≥–∞–º'`

---

### 2. assertions.ts ‚Äî –î–æ–±–∞–≤–ª–µ–Ω UNKNOWN

#### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Record<TransportType, number>:
- **`baseRates`** (—Å—Ç—Ä–æ–∫–∞ 141): –¥–æ–±–∞–≤–ª–µ–Ω `[TransportType.UNKNOWN]: 5.0`

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö Record<TransportType, ...> –≤ –ø—Ä–æ–µ–∫—Ç–µ

#### ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω—ã):
- **SmartRouteBuilder.ts**: `speeds` –∏ `colors` —Å–æ–¥–µ—Ä–∂–∞—Ç `UNKNOWN`
- **PriceCalculator.ts**: `BASE_RATES` –∏ `SEASON_COEFFICIENTS` —Å–æ–¥–µ—Ä–∂–∞—Ç `UNKNOWN`
- **RouteValidator.ts**: `baseRates` –∏ `mapping` —Å–æ–¥–µ—Ä–∂–∞—Ç `UNKNOWN`
- **RouteErrorDetector.ts**: `mapping` —Å–æ–¥–µ—Ä–∂–∏—Ç `UNKNOWN`

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –§–∞–π–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| `RealityChecker.ts` | 3 –º–µ—Ç–æ–¥–∞ + 2 Record —Ç–∏–ø–∞ | ‚úÖ |
| `assertions.ts` | 1 Record —Ç–∏–ø | ‚úÖ |
| –í—Å–µ–≥–æ –º–µ—Ç–æ–¥–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | 3 | ‚úÖ |
| –í—Å–µ–≥–æ Record —Ç–∏–ø–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 3 | ‚úÖ |

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤

### checkHubReality
```typescript
private checkHubReality(
  segment: SmartRouteSegment,
  route: SmartRoute
): { issue?: string; correction?: ...; metadata?: ... }
```

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤–∏–∞-—Å–µ–≥–º–µ–Ω—Ç—ã
2. –ï—Å–ª–∏ –µ—Å—Ç—å `viaHubs`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å:
   - –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ `ALL_HUBS`
   - –õ–æ–≥–∏—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —É–¥–ª–∏–Ω—è—é—Ç –º–∞—Ä—à—Ä—É—Ç –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 50%)
3. –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (>2000 –∫–º) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö–∞–±–æ–≤

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `hub_mismatch` ‚Äî —Ö–∞–± –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª–µ–Ω

---

### checkTransferReality
```typescript
private checkTransferReality(
  segment: SmartRouteSegment,
  route: SmartRoute
): { issue?: string; correction?: ...; metadata?: ... }
```

**–õ–æ–≥–∏–∫–∞:**
1. –ù–∞—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–µ–≥–º–µ–Ω—Ç –≤ –º–∞—Ä—à—Ä—É—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (`segment.to.id === nextSegment.from.id`)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏:
   - –ê–≤–∏–∞ ‚Üí –ê–≤–∏–∞: 60 –º–∏–Ω
   - –ü–æ–µ–∑–¥ ‚Üí –ü–æ–µ–∑–¥: 15 –º–∏–Ω
   - –ê–≤—Ç–æ–±—É—Å ‚Üí –ê–≤—Ç–æ–±—É—Å: 10 –º–∏–Ω
   - –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã: 45 –º–∏–Ω
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `transfer_mismatch` ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –ø–µ—Ä–µ—Å–∞–¥–∫–µ

---

### checkSeasonalityReality
```typescript
private checkSeasonalityReality(
  segment: SmartRouteSegment,
  route: SmartRoute
): { issue?: string; correction?: ...; metadata?: ... }
```

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å–µ–∑–æ–Ω (`segment.seasonality.available`)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ —Ç–∏–ø—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:
   - `WINTER_ROAD`: —Ç–æ–ª—å–∫–æ `WINTER` –∏ `TRANSITION`
   - `FERRY`: —Ç–æ–ª—å–∫–æ `SUMMER` –∏ `TRANSITION`
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ: –≤—Å–µ —Å–µ–∑–æ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `seasonality_mismatch` ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏

---

## üéØ –ó–Ω–∞—á–µ–Ω–∏—è UNKNOWN –≤ Record —Ç–∏–ø–∞—Ö

–í—Å–µ `Record<TransportType, ...>` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è `UNKNOWN`:

| –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ UNKNOWN | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----|------------------|-------------|
| `Record<TransportType, number>` (baseRates) | `5.0` | –°—Ä–µ–¥–Ω–∏–π —Ç–∞—Ä–∏—Ñ (–∫–∞–∫ —É AIRPLANE) |
| `Record<TransportType, string>` (pathType) | `'–¥–æ—Ä–æ–≥–∞–º'` | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–∏–ø –ø—É—Ç–∏ |
| `Record<TransportType, string>` (stopType) | `'bus_station'` | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ |

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –í—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –í—Å–µ `Record<TransportType, ...>` —Å–æ–¥–µ—Ä–∂–∞—Ç `UNKNOWN`
- ‚úÖ –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫—É:

```bash
# –í Docker
docker-compose up --build

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
npm run build
npm run start
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**: –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å —É—á–µ—Ç–æ–º –ª–æ–≥–∏–∫–∏ —Å–º–∞—Ä—Ç-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
2. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã, –±–µ–∑ `any`
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ú–µ—Ç–æ–¥—ã –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2024
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã



