# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–∏—Å–∫–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ - –ó–ê–í–ï–†–®–ï–ù–û

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Swagger –ø–æ–∫–∞–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É "Could not resolve reference" –¥–ª—è `RiskScore`.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ `RiskScore` –≤ `InsuranceController.ts`
- –°—Ö–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `value`, `level`, `description`
- –í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `#/components/schemas/RiskScore` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–§–∞–π–ª—ã:**
- `backend/src/presentation/controllers/InsuranceController.ts`

### ‚úÖ 2. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç riskScore

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `SmartRouteController` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç `riskScore` –∫ –∫–∞–∂–¥–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É
- `AssessSegmentRiskUseCase` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
- `AssessSegmentRiskUseCase` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- `riskScore` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `routeJSON.segments` –∏ `alternativesWithRisk`

**–§–∞–π–ª—ã:**
- `backend/src/presentation/controllers/SmartRouteController.ts` (—Å—Ç—Ä–æ–∫–∏ 508-549, 552-599)

### ‚úÖ 3. SmartRoute –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç riskScore –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç: `routeJSON.segments` —Å–æ–¥–µ—Ä–∂–∏—Ç `riskScore` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã: `alternativesWithRisk` —Å–æ–¥–µ—Ä–∂–∏—Ç `riskScore` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –µ—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, —Å–µ–≥–º–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±–µ–∑ `riskScore` (–Ω–µ –ø–∞–¥–∞–µ—Ç)

**–§–∞–π–ª—ã:**
- `backend/src/presentation/controllers/SmartRouteController.ts` (—Å—Ç—Ä–æ–∫–∏ 508-599)

### ‚úÖ 4. Frontend API –≤—ã–∑–æ–≤—ã

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `useRoutesSearch` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/smart-route/build` (POST)
- `useSmartRouteSearch` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/smart-route/build` (POST)
- Backend –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –ø—É—Ç–∏: `/smart-route/build` –∏ `/smart-routes/build`
- –ê–¥–∞–ø—Ç–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç `riskScore` –∏–∑ –æ—Ç–≤–µ—Ç–∞ backend

**–§–∞–π–ª—ã:**
- `frontend/src/modules/routes/hooks/use-routes-search.ts`
- `frontend/src/modules/routes/hooks/use-smart-route-search.ts`
- `backend/src/presentation/routes/index.ts`

### ‚úÖ 5. Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∏—Å–∫–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `RouteRiskBadge` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `RouteRiskAssessment` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `page.tsx` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `riskScore` –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏ "–ö—É–ø–∏—Ç—å"
- `page.tsx` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `RouteRiskBadge` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –ê–¥–∞–ø—Ç–µ—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç `riskScore` –≤ `IRouteSegmentDetails`

**–§–∞–π–ª—ã:**
- `frontend/src/app/routes/page.tsx`
- `frontend/src/modules/routes/ui/route-risk-badge.tsx`
- `frontend/src/modules/routes/features/route-details/ui/route-risk-assessment.tsx`
- `frontend/src/modules/routes/utils/smart-route-to-built-route-adapter.ts`
- `frontend/src/modules/routes/lib/smart-route-adapter.ts`

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Swagger —Å—Ö–µ–º–∞ RiskScore

```yaml
RiskScore:
  type: object
  required:
    - value
    - level
    - description
  properties:
    value:
      type: number
      minimum: 1
      maximum: 10
      description: –ó–Ω–∞—á–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –æ—Ç 1 –¥–æ 10
      example: 5
    level:
      type: string
      enum: [very_low, low, medium, high, very_high]
      description: –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
      example: medium
    description:
      type: string
      description: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∏—Å–∫–∞
      example: –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫ –∑–∞–¥–µ—Ä–∂–µ–∫
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ SmartRouteController

```typescript
{
  success: true,
  route: {
    id: string,
    segments: [
      {
        id: string,
        type: string,
        riskScore: {
          value: number,      // 1-10
          level: string,      // very_low, low, medium, high, very_high
          description: string
        },
        // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞
      }
    ],
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –º–∞—Ä—à—Ä—É—Ç–∞
  },
  alternatives: [
    {
      segments: [
        {
          riskScore: { ... }
        }
      ]
    }
  ],
  validation: { ... },
  executionTimeMs: number
}
```

### Frontend –æ–±—Ä–∞–±–æ—Ç–∫–∞ riskScore

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
   - `useRoutesSearch` –∏ `useSmartRouteSearch` –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç –æ—Ç `/smart-route/build`
   - –ê–¥–∞–ø—Ç–µ—Ä—ã (`adaptSmartRouteToIBuiltRoute`) –∏–∑–≤–ª–µ–∫–∞—é—Ç `riskScore` –∏–∑ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
   - `riskScore` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `IRouteSegmentDetails`

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ `riskScore.value` - —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10
   - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ `riskScore.level` - –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ enum
   - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ `riskScore` —É–¥–∞–ª—è—é—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
   - `RouteRiskBadge` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
   - `RouteRiskAssessment` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∏—Å–∫–µ
   - –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ (>= 7)

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### Backend
- ‚úÖ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫
- ‚úÖ Backend —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `riskScore` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –∏ —Å–µ–≥–º–µ–Ω—Ç—ã –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Frontend
- ‚úÖ Frontend –ø–æ–ª—É—á–∞–µ—Ç `riskScore` –∏–∑ API
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Ç–∞—é—Ç `riskScore`
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –ø–∞–¥–∞—é—Ç, –µ—Å–ª–∏ `riskScore` –µ—Å—Ç—å –∏–ª–∏ –Ω–µ—Ç
- ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –≤–∏–¥–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Å–ø–∏—Å–∫–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –¥–µ—Ç–∞–ª—è—Ö –º–∞—Ä—à—Ä—É—Ç–∞
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ

### –°–∏—Å—Ç–µ–º–∞
- ‚úÖ –í—Å—è —Å–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Ä–∏—Å–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π
- ‚úÖ UI —Å–Ω–æ–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∏—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–∏–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –ø–æ–ª–Ω–∞—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **API –ø—É—Ç–∏:** Backend –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –ø—É—Ç–∏ (`/smart-route/build` –∏ `/smart-routes/build`) –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞, —Å–µ–≥–º–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±–µ–∑ `riskScore`, –Ω–æ –º–∞—Ä—à—Ä—É—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç.

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** Frontend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `riskScore` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏ —É–¥–∞–ª—è–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º.

4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–∫—É–ø–∫–∏:** –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏:
   - –†–∏—Å–∫–µ –º–∞—Ä—à—Ä—É—Ç–∞ >= 7
   - –†–∏—Å–∫–µ –ª—é–±–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ >= 7
   - –£—Ä–æ–≤–Ω–µ —Ä–∏—Å–∫–∞ HIGH –∏–ª–∏ VERY_HIGH

## üéØ –°—Ç–∞—Ç—É—Å: –í–°–ï –ó–ê–î–ê–ß–ò –í–´–ü–û–õ–ù–ï–ù–´

–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.


